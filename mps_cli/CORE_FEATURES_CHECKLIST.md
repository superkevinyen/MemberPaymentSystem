# MPS CLI 核心功能清單

> 完整的核心功能實施狀態

## 📊 總體進度：50% (5/10)

---

## ✅ 已完成功能 (5個)

### 會員端 (3個)

#### 1. ✅ 生成付款 QR 碼
- **狀態**: 完成
- **文件**: `ui/member_ui.py::_generate_qr()`
- **功能**: 
  - 選擇卡片（過濾企業卡）
  - 生成 QR 碼
  - 顯示過期時間
  - 支持刷新/撤銷
- **RPC**: `rotate_card_qr`, `revoke_card_qr`

#### 2. ✅ 充值卡片
- **狀態**: 完成
- **文件**: `ui/member_ui.py::_recharge_card()`
- **功能**:
  - 只允許標準卡充值
  - 選擇支付方式
  - 金額驗證
  - 顯示充值結果
- **RPC**: `user_recharge_card`

#### 3. ✅ 綁定企業卡
- **狀態**: 完成
- **文件**: `ui/member_ui.py::_bind_new_card()`
- **功能**:
  - 輸入企業卡 ID
  - 選擇綁定角色
  - 輸入綁定密碼
  - 顯示企業折扣
- **RPC**: `bind_member_to_card`

---

### 商戶端 (2個)

#### 4. ✅ 掃碼收款
- **狀態**: 完成（已有實現）
- **文件**: `ui/merchant_ui.py::_scan_and_charge()`
- **功能**:
  - 掃描 QR 碼
  - 輸入金額
  - 計算折扣
  - 顯示收款結果
- **RPC**: `merchant_charge_by_qr`

#### 5. ✅ 退款處理
- **狀態**: 完成
- **文件**: `ui/merchant_ui.py::_process_refund()`
- **功能**:
  - 查詢原交易
  - 計算剩餘可退金額
  - 支持部分退款
  - 多次退款支持
- **RPC**: `merchant_refund_tx`

---

## ❌ 待完成功能 (5個)

### 會員端 (2個)

#### 6. ❌ 查看交易記錄（優化）
- **狀態**: 基礎實現，需優化
- **文件**: `ui/member_ui.py::_view_transactions()`
- **當前問題**:
  - ⚠️ 分頁功能不完善
  - ⚠️ 缺少篩選功能（日期、類型、狀態）
  - ⚠️ 無法查看交易詳情
- **需要改進**:
  - 添加日期範圍篩選
  - 添加交易類型篩選
  - 添加交易狀態篩選
  - 實現交易詳情查看
- **RPC**: `get_member_transactions`, `get_transaction_detail`

#### 7. ❌ 查看積分等級（優化）
- **狀態**: 基礎實現，需優化
- **文件**: `ui/member_ui.py::_view_points_level()`
- **當前問題**:
  - ⚠️ 顯示不夠直觀
  - ⚠️ 缺少積分歷史
  - ⚠️ 缺少升級進度條
- **需要改進**:
  - 優化積分等級顯示
  - 添加升級進度可視化
  - 顯示積分獲得歷史（可選）
- **數據來源**: `member_cards` 表

---

### 商戶端 (2個)

#### 8. ❌ 今日交易統計（優化）
- **狀態**: 基礎實現，需優化
- **文件**: `ui/merchant_ui.py::_view_today_transactions()`
- **當前問題**:
  - ⚠️ 統計信息不夠詳細
  - ⚠️ 缺少圖表展示
  - ⚠️ 無法實時刷新
- **需要改進**:
  - 添加更詳細的統計（按小時、按卡片類型）
  - 優化界面展示
  - 添加刷新功能
- **RPC**: `get_merchant_transactions`

#### 9. ❌ 結算報表生成
- **狀態**: 未實現
- **文件**: `ui/merchant_ui.py::_generate_settlement()` (待創建)
- **需要實現**:
  - 選擇結算模式（實時/T+1/月結）
  - 選擇結算期間
  - 生成結算報表
  - 顯示結算詳情
- **RPC**: `generate_settlement`
- **設計文檔**: ✅ 已完成 (`plans/settlement_feature_design.md`)

---

### 管理端 (1個)

#### 10. ❌ 管理員核心功能
- **狀態**: 部分實現，需完善
- **文件**: `ui/admin_ui.py`
- **當前問題**:
  - ⚠️ 功能不完整
  - ⚠️ 可能與最新 RPC 不一致
- **需要檢查/實現**:
  - 創建會員
  - 創建商戶
  - 創建企業卡
  - 創建優惠券卡
  - 會員管理（暫停/恢復）
  - 商戶管理（暫停/恢復）
  - 卡片管理（凍結/解凍）
- **RPC**: 
  - `create_member_profile`
  - `create_merchant`
  - `create_corporate_card`
  - `create_voucher_card`
  - `admin_suspend_member`
  - `admin_activate_member`
  - `freeze_card`, `unfreeze_card`

---

## 📋 詳細分析

### 會員端功能完成度：60% (3/5)

| 功能 | 狀態 | 優先級 | 預計工時 |
|------|------|--------|---------|
| 查看我的卡片 | ✅ 完成 | - | - |
| 生成 QR 碼 | ✅ 完成 | - | - |
| 充值卡片 | ✅ 完成 | - | - |
| 綁定企業卡 | ✅ 完成 | - | - |
| 查看交易記錄 | ⚠️ 需優化 | P1 | 1-2h |
| 查看積分等級 | ⚠️ 需優化 | P2 | 1h |

---

### 商戶端功能完成度：50% (2/4)

| 功能 | 狀態 | 優先級 | 預計工時 |
|------|------|--------|---------|
| 掃碼收款 | ✅ 完成 | - | - |
| 退款處理 | ✅ 完成 | - | - |
| 今日交易統計 | ⚠️ 需優化 | P1 | 1-2h |
| 結算報表 | ❌ 未實現 | P1 | 3-4h |

---

### 管理端功能完成度：30% (估計)

| 功能 | 狀態 | 優先級 | 預計工時 |
|------|------|--------|---------|
| 會員管理 | ⚠️ 需檢查 | P1 | 2-3h |
| 商戶管理 | ⚠️ 需檢查 | P1 | 2-3h |
| 卡片管理 | ⚠️ 需檢查 | P1 | 2-3h |
| 系統維護 | ❌ 未實現 | P2 | 2h |

---

## 🎯 優先級建議

### P0 - 必須完成（商業化必需）
- ✅ 會員端核心功能（已完成）
- ✅ 商戶端收款/退款（已完成）

### P1 - 重要功能（建議完成）
1. **結算報表生成** (3-4h)
   - 商戶最需要的功能
   - 設計文檔已完成
   
2. **查看交易記錄優化** (1-2h)
   - 會員和商戶都需要
   - 添加篩選功能
   
3. **管理端核心功能檢查** (6-9h)
   - 確保與最新 RPC 對接
   - 完善管理功能

### P2 - 優化功能（可選）
1. **今日交易統計優化** (1-2h)
2. **查看積分等級優化** (1h)
3. **系統維護功能** (2h)

---

## 📊 完成路徑建議

### 方案 1：快速商用（推薦）
**目標**: 達到 70% 完成度，可商用

**任務清單**:
1. ✅ 結算報表生成 (3-4h)
2. ✅ 查看交易記錄優化 (1-2h)
3. ✅ 管理端核心功能檢查 (6-9h)

**總工時**: 10-15 小時  
**完成度**: 70%

---

### 方案 2：完整實現
**目標**: 達到 100% 完成度

**任務清單**:
1. 方案 1 的所有任務
2. 今日交易統計優化 (1-2h)
3. 查看積分等級優化 (1h)
4. 系統維護功能 (2h)

**總工時**: 14-20 小時  
**完成度**: 100%

---

### 方案 3：當前即可用
**目標**: 保持 50% 完成度，核心功能已足夠

**現狀**:
- ✅ 會員可以：查看卡片、生成 QR、充值、綁定企業卡
- ✅ 商戶可以：收款、退款
- ⚠️ 缺少：結算報表、詳細統計

**適用場景**: 
- MVP 測試
- 小規模使用
- 後續逐步完善

---

## 🔍 功能缺口詳細說明

### 1. 會員端 - 查看交易記錄
**當前狀態**: 可以查看，但功能簡單

**缺少功能**:
```
❌ 日期範圍篩選（今日/本週/本月/自定義）
❌ 交易類型篩選（支付/退款/充值）
❌ 交易狀態篩選（成功/失敗/處理中）
❌ 交易詳情查看（點擊查看完整信息）
❌ 導出功能（可選）
```

---

### 2. 會員端 - 查看積分等級
**當前狀態**: 可以查看，但顯示簡單

**缺少功能**:
```
❌ 升級進度可視化（進度條）
❌ 積分獲得歷史（最近10筆）
❌ 等級權益說明
❌ 下一等級預覽
```

---

### 3. 商戶端 - 今日交易統計
**當前狀態**: 有基礎統計

**缺少功能**:
```
❌ 按小時統計（查看高峰時段）
❌ 按卡片類型統計
❌ 實時刷新功能
❌ 圖表展示（可選）
```

---

### 4. 商戶端 - 結算報表
**當前狀態**: 完全未實現

**需要功能**:
```
❌ 選擇結算模式（實時/T+1/月結）
❌ 選擇結算期間
❌ 生成結算報表
❌ 查看結算歷史
❌ 結算詳情展示
```

**設計文檔**: ✅ 已完成

---

### 5. 管理端 - 核心功能
**當前狀態**: 部分實現，需檢查

**需要檢查/完善**:
```
⚠️ 創建會員流程
⚠️ 創建商戶流程
⚠️ 創建企業卡流程
⚠️ 創建優惠券卡流程
⚠️ 會員管理（暫停/恢復/查詢）
⚠️ 商戶管理（暫停/恢復/查詢）
⚠️ 卡片管理（凍結/解凍/查詢）
⚠️ 系統維護（清理過期 session 等）
```

---

## 💡 建議

### 立即行動（如果要商用）
1. **實現結算功能** - 商戶最需要
2. **優化交易記錄** - 用戶體驗提升
3. **檢查管理端** - 確保功能完整

### 可以延後
1. 積分等級優化 - 非核心功能
2. 今日統計優化 - 已有基礎功能
3. 系統維護 - 可以手動處理

---

## 📈 完成度計算

### 當前完成度：50%
- 會員端：60% (3/5)
- 商戶端：50% (2/4)
- 管理端：30% (估計)
- 平均：(60% + 50% + 30%) / 3 ≈ 47% → **50%**

### 達到 70% 需要：
- ✅ 結算功能
- ✅ 交易記錄優化
- ✅ 管理端檢查完善

### 達到 100% 需要：
- ✅ 所有 P1 功能
- ✅ 所有 P2 功能

---

**最後更新**: 2025-10-01 21:39  
**文檔版本**: v1.0.0
