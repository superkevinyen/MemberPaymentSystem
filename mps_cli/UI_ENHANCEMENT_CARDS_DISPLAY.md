# UI 增強：會員操作菜單顯示卡片信息

> 更新時間：2025-10-06 15:11  
> 狀態：✅ 已完成

---

## 🎯 改進目標

在會員操作菜單中顯示該會員擁有和綁定的所有卡片信息，讓管理員可以快速查看會員的卡片狀態。

---

## ✨ 改進內容

### 改進前

```
═══════════════════════════════════════════════════════════════════════════
會員操作 - Kevin Yen
═══════════════════════════════════════════════════════════════════════════
會員號：  M00000073
姓名：    Kevin Yen
手機：    18618606040
郵箱：    yenfat@gmail.com
狀態：    激活
創建時間：2025-10-06 07:03:21
═══════════════════════════════════════════════════════════════════════════

請選擇操作:
1. 📋 查看完整詳情 (View Full Details)
2. ✏️  編輯資料 (Edit Profile)
...
```

**問題**：
- ❌ 看不到會員有哪些卡片
- ❌ 看不到卡片餘額
- ❌ 看不到卡片狀態
- ❌ 需要進入"管理卡片"才能查看

---

### 改進後

```
═══════════════════════════════════════════════════════════════════════════
會員操作 - Kevin Yen
═══════════════════════════════════════════════════════════════════════════
會員號：  M00000073
姓名：    Kevin Yen
手機：    18618606040
郵箱：    yenfat@gmail.com
狀態：    激活
創建時間：2025-10-06 07:03:21
═══════════════════════════════════════════════════════════════════════════

💳 會員卡片：
───────────────────────────────────────────────────────────────────────────
1. C202501001 (標準卡) - 餘額: ¥1,000.00 - 狀態: 活躍
2. C202501002 (企業卡) - 餘額: ¥5,000.00 - 狀態: 活躍
3. C202501003 (VIP卡) - 餘額: ¥10,000.00 - 狀態: 活躍
───────────────────────────────────────────────────────────────────────────

請選擇操作:
1. 📋 查看完整詳情 (View Full Details)
2. ✏️  編輯資料 (Edit Profile)
...
```

**優勢**：
- ✅ 一目了然看到所有卡片
- ✅ 顯示卡號（零 UUID）
- ✅ 顯示卡片類型
- ✅ 顯示餘額
- ✅ 顯示狀態
- ✅ 無需額外操作

---

## 📊 顯示信息

### 卡片信息包含

| 信息 | 說明 | 示例 |
|------|------|------|
| **序號** | 卡片編號 | 1, 2, 3... |
| **卡號** | 業務識別碼 | C202501001 |
| **類型** | 卡片類型 | 標準卡/企業卡/VIP卡 |
| **餘額** | 當前餘額 | ¥1,000.00 |
| **狀態** | 卡片狀態 | 活躍/凍結/過期 |

### 特殊情況處理

#### 1. 無卡片
```
💳 會員卡片：暫無卡片
───────────────────────────────────────────────────────────────────────────
```

#### 2. 載入失敗
```
💳 會員卡片：無法載入 (錯誤信息)
───────────────────────────────────────────────────────────────────────────
```

---

## 🔧 技術實現

### 實現代碼

```python
def _member_action_menu(self, member):
    """會員操作菜單（零 UUID 暴露）"""
    while True:
        BaseUI.clear_screen()
        
        # 顯示會員信息
        print("═" * 79)
        print(f"會員操作 - {member.name}")
        print("═" * 79)
        print(f"會員號：  {member.member_no}")
        print(f"姓名：    {member.name}")
        print(f"手機：    {member.phone}")
        print(f"郵箱：    {member.email}")
        print(f"狀態：    {member.get_status_display()}")
        print(f"創建時間：{member.format_datetime('created_at')}")
        print("═" * 79)
        
        # 顯示會員的卡片信息
        try:
            cards = self.member_service.get_member_cards(member.id)
            if cards:
                print("\n💳 會員卡片：")
                print("─" * 79)
                for i, card in enumerate(cards, 1):
                    card_info = f"{i}. {card.card_no} ({card.get_card_type_display()}) - "
                    card_info += f"餘額: {Formatter.format_currency(card.balance)} - "
                    card_info += f"狀態: {card.get_status_display()}"
                    print(card_info)
                print("─" * 79)
            else:
                print("\n💳 會員卡片：暫無卡片")
                print("─" * 79)
        except Exception as e:
            print(f"\n💳 會員卡片：無法載入 ({e})")
            print("─" * 79)
        
        # 操作選項
        options = [...]
        choice = BaseUI.show_menu(options, "請選擇操作")
        ...
```

### 關鍵點

1. **獲取卡片**：使用 `get_member_cards()` 獲取會員的所有卡片
2. **包含綁定卡**：該方法會返回會員擁有的卡片和綁定的共享卡片
3. **異常處理**：使用 try-except 確保即使載入失敗也不會中斷流程
4. **格式化顯示**：使用 `Formatter.format_currency()` 格式化金額

---

## 📋 顯示的卡片類型

### 1. 擁有的卡片

會員作為 owner 的卡片：
- 標準卡（自動創建）
- 企業卡（管理員創建）
- VIP卡（升級獲得）

### 2. 綁定的卡片

會員綁定的共享卡片：
- 家庭共享卡
- 企業共享卡
- 其他會員授權的卡片

**注意**：`get_member_cards()` 方法會自動合併並去重這兩種類型的卡片。

---

## 🎨 UI 展示示例

### 示例 1：有多張卡片

```
═══════════════════════════════════════════════════════════════════════════
會員操作 - 張三
═══════════════════════════════════════════════════════════════════════════
會員號：  M202501001
姓名：    張三
手機：    13800138000
郵箱：    zhang@example.com
狀態：    活躍
創建時間：2025-01-01 10:00:00
═══════════════════════════════════════════════════════════════════════════

💳 會員卡片：
───────────────────────────────────────────────────────────────────────────
1. C202501001 (標準卡) - 餘額: ¥1,000.00 - 狀態: 活躍
2. C202501005 (企業卡) - 餘額: ¥5,000.00 - 狀態: 活躍
3. C202501010 (VIP卡) - 餘額: ¥10,000.00 - 狀態: 活躍
───────────────────────────────────────────────────────────────────────────

請選擇操作:
1. 📋 查看完整詳情 (View Full Details)
2. ✏️  編輯資料 (Edit Profile)
3. 🔒 重置密碼 (Reset Password)
4. 💳 管理卡片 (Manage Cards)
5. 💰 卡片充值 (Recharge Card)
6. 💸 申請退款 (Request Refund)
7. 📊 查看交易記錄 (View Transactions)
8. ⏸️  暫停/激活 (Suspend/Activate)
9. 🔙 返回搜尋 (Back to Search)

Select (1-9): 
```

### 示例 2：只有一張卡片

```
═══════════════════════════════════════════════════════════════════════════
會員操作 - 李四
═══════════════════════════════════════════════════════════════════════════
會員號：  M202501002
姓名：    李四
手機：    13812345678
郵箱：    li@example.com
狀態：    活躍
創建時間：2025-01-02 11:00:00
═══════════════════════════════════════════════════════════════════════════

💳 會員卡片：
───────────────────────────────────────────────────────────────────────────
1. C202501002 (標準卡) - 餘額: ¥500.00 - 狀態: 活躍
───────────────────────────────────────────────────────────────────────────

請選擇操作:
...
```

### 示例 3：無卡片

```
═══════════════════════════════════════════════════════════════════════════
會員操作 - 王五
═══════════════════════════════════════════════════════════════════════════
會員號：  M202501003
姓名：    王五
手機：    13898765432
郵箱：    wang@example.com
狀態：    活躍
創建時間：2025-01-03 12:00:00
═══════════════════════════════════════════════════════════════════════════

💳 會員卡片：暫無卡片
───────────────────────────────────────────────────────────────────────────

請選擇操作:
...
```

### 示例 4：有凍結卡片

```
═══════════════════════════════════════════════════════════════════════════
會員操作 - 趙六
═══════════════════════════════════════════════════════════════════════════
會員號：  M202501004
姓名：    趙六
手機：    13999999999
郵箱：    zhao@example.com
狀態：    活躍
創建時間：2025-01-04 13:00:00
═══════════════════════════════════════════════════════════════════════════

💳 會員卡片：
───────────────────────────────────────────────────────────────────────────
1. C202501004 (標準卡) - 餘額: ¥2,000.00 - 狀態: 活躍
2. C202501006 (企業卡) - 餘額: ¥0.00 - 狀態: 凍結
───────────────────────────────────────────────────────────────────────────

請選擇操作:
...
```

---

## ✅ 改進效果

### 用戶體驗提升

| 指標 | 改進前 | 改進後 | 提升 |
|------|--------|--------|------|
| **查看卡片** | 需要進入子菜單 | 直接顯示 | ⭐⭐⭐⭐⭐ |
| **信息完整性** | 需要多次操作 | 一次顯示 | ⭐⭐⭐⭐⭐ |
| **操作效率** | 3-4 步 | 0 步 | ⭐⭐⭐⭐⭐ |
| **視覺清晰度** | 一般 | 優秀 | ⭐⭐⭐⭐⭐ |

### 功能完整性

- ✅ 顯示所有卡片（擁有 + 綁定）
- ✅ 顯示卡號（零 UUID）
- ✅ 顯示卡片類型
- ✅ 顯示餘額
- ✅ 顯示狀態
- ✅ 異常處理完善
- ✅ 格式化顯示

---

## 🎯 使用場景

### 場景 1：快速查看會員資產

管理員可以在會員操作菜單中直接看到：
- 會員有幾張卡
- 每張卡的餘額
- 每張卡的狀態

無需進入子菜單，提升效率。

### 場景 2：選擇充值卡片

在選擇"卡片充值"之前，管理員可以：
- 查看所有卡片
- 確認哪張卡需要充值
- 查看當前餘額

### 場景 3：檢查卡片狀態

管理員可以快速發現：
- 是否有凍結的卡片
- 是否有餘額為 0 的卡片
- 是否有過期的卡片

---

## 📝 總結

### 改進亮點

1. **✅ 信息即時顯示** - 無需額外操作
2. **✅ 零 UUID 暴露** - 只顯示卡號
3. **✅ 格式化友好** - 金額、狀態清晰
4. **✅ 異常處理** - 載入失敗不影響流程
5. **✅ 包含所有卡片** - 擁有 + 綁定

### 用戶反饋

**預期效果**：
- 管理員可以更快速地了解會員的卡片情況
- 減少操作步驟
- 提升工作效率

---

**更新人員**: AI Assistant  
**更新日期**: 2025-10-06  
**狀態**: ✅ 已完成  
**建議**: 可以立即使用
